"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3219],{3219:(j,m,r)=>{r.r(m),r.d(m,{MessagePageModule:()=>_});var c=r(177),d=r(4341),p=r(7112),g=r(8974),f=r(1626),u=r(3833),h=r(467),M=r(9866),e=r(6276),x=r(7157),v=r(6038);const b=["textArea"];function y(n,a){if(1&n&&(e.j41(0,"div")(1,"div")(2,"p",22),e.EFF(3),e.k0s()()()),2&n){const i=a.$implicit,s=e.XpG();e.HbH(s.utils.cn(i.isSender?"pl-5":"pr-5")),e.R7$(1),e.HbH(s.utils.cn("flex items-center gap-4 py-2 rounded-3xl max-w-max px-4 text-sm",i.isSender?"bg-primary rounded-tr-none ml-auto":"bg-muted rounded-tl-none")),e.R7$(2),e.JRh(i.message)}}function C(n,a){1&n&&(e.qex(0),e.j41(1,"div",23),e.nrm(2,"div",24),e.k0s(),e.bVm())}function S(n,a){if(1&n&&(e.qex(0),e.j41(1,"div",25)(2,"div",26)(3,"p",22),e.EFF(4),e.k0s()()(),e.bVm()),2&n){const i=e.XpG();e.R7$(4),e.SpI(" ",i.messageSending," ")}}function P(n,a){if(1&n){const i=e.RV6();e.qex(0),e.j41(1,"ion-icon",27),e.bIt("click",function(){e.eBV(i);const t=e.XpG();return e.Njj(t.addMessage())}),e.k0s(),e.bVm()}}function k(n,a){1&n&&e.nrm(0,"ion-spinner",28)}const w=function(){return{standalone:!0}},I=[{path:"",component:(()=>{var n;class a{constructor(s,t,o,l,F,R){this.navCtrl=s,this.router=t,this.apiMessage=o,this.cdr=l,this.menu=F,this.socketService=R,this.newMsgRegister={},this.newMsg="",this.isSending=!1,this.messageSending="",this.isWritting=!1,this.utils=new M.b}ngOnInit(){this.socketService.listen("newMessage",s=>{this.handleNewMessage(s)})}ionViewWillEnter(){this.userMessages=this.details("messages"),this.dataChat=this.details("all"),this.viewsAll()}ngAfterViewInit(){setTimeout(()=>{this.scrollToBottom()},500)}details(s){const t=localStorage.getItem("messages");return t?"messages"===s?JSON.parse(t).messages:JSON.parse(t):{}}trackMessagesIndex(s,t){return t.id}openMenu(){var s=this;return(0,h.A)(function*(){yield s.menu.open("app-menu")})()}stablishUrlPic(s){return this.utils.stablishUrlPic(s)}searchIcon(s){return this.stablishUrlPic(s)}scrollToBottom(){var s=this;return(0,h.A)(function*(){s.content&&(yield s.content.scrollToBottom(300))})()}goBack(){var s=this;return(0,h.A)(function*(){s.navCtrl.back()})()}viewsAll(){this.apiMessage.putViewsAll({chats_id:this.dataChat.id})}goTo(s){this.router.navigateByUrl(s)}backspace(){this.goBack()}handleNewMessage(s){if(s.chats_id===this.dataChat.id){const t=s;if(!this.userMessages.some(l=>l.id===t.id)){const l=localStorage.getItem("user_id");t.isSender=null!==l&&""!==l&&parseInt(l)===s.user_id,this.userMessages.push(t),this.cdr.detectChanges(),setTimeout(()=>{this.scrollToBottom()},300)}}}addMessage(){if(this.newMsg){const s={message:this.newMsg,chats_id:this.dataChat.id};this.messageSending=this.newMsg,this.newMsg="",this.isSending=!0,this.apiMessage.postMessage(s).subscribe({next:t=>{this.isSending=!1,this.cdr.detectChanges()},error:()=>{this.isSending=!1,this.cdr.detectChanges()},complete:()=>{this.isSending=!1,this.cdr.detectChanges()}})}}getAllMessages(){this.isWritting=!0,this.apiMessage.getChat({}).subscribe({next:s=>{try{const t=Array.isArray(s)?s.find(o=>o.id==this.dataChat.id):s;t&&t.messages&&(this.userMessages=t.messages,localStorage.setItem("messages",JSON.stringify(t))),this.messageSending="",this.isWritting=!1,this.cdr.detectChanges()}catch(t){this.messageSending="",this.isWritting=!1,this.cdr.detectChanges(),console.error("Error procesando los mensajes:",t)}},error:s=>{this.messageSending="",this.isWritting=!1,this.cdr.detectChanges(),console.error("Error en la API:",s)},complete:()=>{this.messageSending="",this.isWritting=!1,this.cdr.detectChanges()}})}}return(n=a).\u0275fac=function(s){return new(s||n)(e.rXU(x.q9),e.rXU(u.Ix),e.rXU(p.G),e.rXU(e.gRc),e.rXU(g._t),e.rXU(v.L))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-message"]],viewQuery:function(s,t){if(1&s&&(e.GBs(b,5),e.GBs(g.W9,5)),2&s){let o;e.mGM(o=e.lsd())&&(t.textArea=o.first),e.mGM(o=e.lsd())&&(t.content=o.first)}},decls:26,vars:12,consts:[["mode","ios",1,"ion-no-border","bg-background",3,"translucent"],["color","false",1,""],[1,"flex","px-4","py-5","justify-between","items-center"],[1,"rowAlignCenter","relative",2,"flex","1"],[1,"material-icons","text-primary-foreground","text-[28px]",3,"click"],[1,"column",2,"flex","1"],[1,"text-[20px]","text-primary-foreground","text-center","font-semibold","text-ellipsis","line-clamp-1"],[1,""],["menu","app-menu","color","whiteColor",1,"menu-button-custom",2,"font-size","30px",3,"click"],[1,"bg-background",3,"fullscreen"],[1,"px-2"],[1,"w-full","h-full","max-h-full","flex","flex-col","gap-4","pt-[20px]","overflow-y-auto"],["scrollContainer",""],[3,"class",4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],["mode","ios",1,"bg-background"],[1,"footer","px-2",2,"background-color","hsl(var(--muted))"],["mode","ios","placeholder","Escribe un mensaje","rows","1",1,"whiteColor14Regular",2,"--placeholder-color","var(--grayColor)","--placeholder-opacity","1","--color","hsl(var(--primary-foreground))",3,"disabled","ngModel","ngModelOptions","ngModelChange"],["textArea",""],[1,"center","circle40"],[4,"ngIf","ngIfElse"],["SendingState",""],[1,"text-primary-foreground","text-lg"],[1,"pr-5"],[1,"flex","items-center","gap-4","py-2","rounded-3xl","max-w-max","px-4","h-[72px]","min-w-[250px]","bg-muted","rounded-tl-none","animate-pulse"],[1,"pl-5"],[1,"flex","items-center","gap-4","py-2","rounded-3xl","max-w-max","px-4","bg-primary","rounded-tr-none","ml-auto"],["name","send",1,"text-primary","text-xl",3,"click"],["name","lines-sharp-small",1,"text-primary","text-xl"]],template:function(s,t){if(1&s&&(e.j41(0,"ion-header",0)(1,"ion-toolbar",1)(2,"div",2)(3,"div",3)(4,"span",4),e.bIt("click",function(){return t.goBack()}),e.EFF(5," arrow_back_ios "),e.k0s(),e.j41(6,"div",5)(7,"ion-text",6),e.EFF(8," Atenci\xf3n al cliente "),e.k0s()(),e.j41(9,"ion-text",7)(10,"ion-menu-button",8),e.bIt("click",function(){return t.openMenu()}),e.k0s()()()()()(),e.j41(11,"ion-content",9)(12,"div",10)(13,"div",11,12),e.DNE(15,y,4,5,"div",13),e.DNE(16,C,3,0,"ng-container",14),e.DNE(17,S,5,1,"ng-container",14),e.k0s()()(),e.j41(18,"ion-footer",15)(19,"div",16)(20,"ion-textarea",17,18),e.bIt("ngModelChange",function(l){return t.newMsg=l}),e.k0s(),e.j41(22,"div",19),e.DNE(23,P,2,0,"ng-container",20),e.DNE(24,k,1,0,"ng-template",null,21,e.C5r),e.k0s()()()),2&s){const o=e.sdS(25);e.Y8G("translucent",!1),e.R7$(11),e.Y8G("fullscreen",!0),e.R7$(4),e.Y8G("ngForOf",t.userMessages)("ngForTrackBy",t.trackMessagesIndex),e.R7$(1),e.Y8G("ngIf",t.isWritting),e.R7$(1),e.Y8G("ngIf",t.isSending),e.R7$(3),e.Y8G("disabled",t.isSending)("ngModel",t.newMsg)("ngModelOptions",e.lJ4(11,w)),e.R7$(3),e.Y8G("ngIf",!t.isSending)("ngIfElse",o)}},dependencies:[c.Sq,c.bT,d.BC,d.vS,g.W9,g.M0,g.eU,g.iq,g.MC,g.w2,g.IO,g.nc,g.ai,g.Gw],styles:[".sourceLogo[_ngcontent-%COMP%]{width:46px;height:46px;border-radius:23px;margin-left:20px;margin-right:12px}.footer[_ngcontent-%COMP%]{display:flex;flex-direction:row;padding:5px 20px;background-color:var(--extraLightGrayColor);margin:20px;border-radius:10px}.custom-background[_ngcontent-%COMP%]{--background: #2758BF}.rounded-top-corners[_ngcontent-%COMP%]{border-top-left-radius:20px;border-top-right-radius:20px;overflow:hidden;background-color:#2758bf}"]}),a})()}];let G=(()=>{var n;class a{}return(n=a).\u0275fac=function(s){return new(s||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[u.iI.forChild(I),u.iI]}),a})();var T=r(3887);let _=(()=>{var n;class a{}return(n=a).\u0275fac=function(s){return new(s||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({providers:[p.G],imports:[c.MD,d.YN,g.bv,G,f.q1,T.G]}),a})()}}]);