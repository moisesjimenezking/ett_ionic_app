<ion-modal #editProfileModal mode="md" [keepContentsMounted]="true" [canDismiss]="isSubmitting?false:true"
  trigger="open-edit-profile-modal" style="--border-radius: 16px">
  <ng-template>
    <div
      class="my-2 bg-muted flex flex-col justify-center items-center rounded-xl px-3 py-5 h-full max-h-[720px] overflow-y-auto">
      <ion-text class="text-primary-foreground text-2xl font-semibold text-center mb-7">
        Editar perfil
      </ion-text>

      <div class="w-full flex-1 flex flex-col gap-4 max-h-full overflow-y-auto text-center">
        <div class="w-full flex flex-col gap-2 text-start">
          <ion-text class="text-sm ml-5 text-primary-foreground">
            Nombre
          </ion-text>
          <div class="field">
            <ion-input mode="ios" placeholder="Nombre y apellido" [(ngModel)]="fullName" inputmode="text">
            </ion-input>
          </div>
        </div>

        <div class="w-full flex flex-col gap-2 text-start">
          <ion-text class="text-sm ml-5 text-primary-foreground">
            Correo electrónico
          </ion-text>
          <div class="field relative">
            <ion-input type="email" placeholder="Correo electrónico" [(ngModel)]="email" inputmode="email"
              (ionChange)="validateEmail()">
            </ion-input>

            <button id="openDialogVerific"
              class="flex justify-center items-center outline-none shadow-none h-max w-max absolute top-2/4 -translate-y-2/4 right-1">
              <span [class]="utils.cn('material-icons', emailVerified ? 'text-green-500': 'text-muted')">
                check_circle
              </span>
            </button>
          </div>
          <ion-text color="danger">{{ alertMessageEmail }}</ion-text>
        </div>


        <div class="w-full flex flex-col gap-2 text-start">
          <ion-text class="text-sm ml-5 text-primary-foreground">
            Título o Especialización
          </ion-text>
          <div class="field">
            <ion-input mode="ios" placeholder="Título o Especialización" [(ngModel)]="specialization" inputmode="text">
            </ion-input>
          </div>
        </div>

        <div class="w-full flex flex-col gap-2 text-start">
          <ion-text class="text-sm ml-5 text-primary-foreground"> Número de teléfono móvil</ion-text>
          <div class="field">
            <ion-input mode="ios" placeholder="Ingrese el número de móvil" [(ngModel)]="mobile">
            </ion-input>
          </div>
        </div>

        <div class="w-full flex flex-col gap-2 text-start">
          <ion-text class="text-sm ml-5 text-primary-foreground"> RIF</ion-text>
          <div class="min-h-[48px]">
            <ng-container *ngIf="!isBase64(rifValue); else FileRifLoader">
              <div class="field">
                <ion-input mode="ios" placeholder="Ingrese su RIF" [(ngModel)]="rifValue" inputmode="numeric">
                </ion-input>
              </div>
              <div>
                <ion-chip class="min-w-24 h-8 max-w-max px-3 py-1 rounded-lg bg-accent text-primary-foreground"
                  (click)="inputRif.click()">
                  <span>
                    Cargar RIF
                  </span>
                </ion-chip>
                <input #inputRif type="file" hidden accept=".pdf" (change)="onFileChange($event, 'rif')" />
              </div>
            </ng-container>
            <ng-template #FileRifLoader>
              <app-file-item-loader [base64]="rifValue" filename="RIF" (onRemove)="onRemoveFile('rif')" />
            </ng-template>
          </div>
        </div>

        <div class="w-full flex flex-col gap-2 text-start">
          <ion-text class="text-sm ml-5 text-primary-foreground"> Identificación</ion-text>
          <div class="min-h-[48px]">
            <ng-container *ngIf="!isBase64(identificationValue);else FileIdentificationLoader">
              <div class="field">
                <ion-input mode="ios" placeholder="Ingrese su identificación" [(ngModel)]="identificationValue">
                </ion-input>
              </div>
              <div>
                <ion-chip class="min-w-36 h-8 max-w-max px-3 py-1 rounded-lg bg-accent text-primary-foreground"
                  (click)="inputDNI.click()">
                  <span>
                    Cargar identificación
                  </span>
                </ion-chip>
                <input #inputDNI type="file" hidden accept=".pdf" (change)="onFileChange($event, 'identification')" />
              </div>
            </ng-container>
            <ng-template #FileIdentificationLoader>
              <app-file-item-loader [base64]="identificationValue" filename="Identificación"
                (onRemove)="onRemoveFile('identification')" />
            </ng-template>
          </div>
        </div>
        <!-- 
        <div class="w-full flex flex-col gap-2 text-start">
          <ion-text class="text-sm ml-5 text-primary-foreground"> Licencia de conducir</ion-text>
          <div class="min-h-[48px]">
            <ng-container *ngIf="!utils.isBase64(licenceValue);else FileLicenceLoader">
              <div class="field">
                <ion-input mode="ios" placeholder="Ingrese su identificación" [(ngModel)]="licenceValue">
                </ion-input>
              </div>
              <div>
                <ion-chip class="min-w-36 h-8 max-w-max px-3 py-1 rounded-lg bg-accent text-primary-foreground"
                  (click)="inputLicence.click()">
                  <span>
                    Cargar licencia
                  </span>
                </ion-chip>
                <input #inputLicence type="file" hidden accept=".pdf" (change)="onFileChange($event, 'licence')" />
              </div>
            </ng-container>
            <ng-template #FileLicenceLoader>
              <app-file-item-loader [base64]="licenceValue" filename="Licencia" (onRemove)="licenceValue=''" />
            </ng-template>
          </div>
        </div> -->

        <div class="w-full flex flex-col gap-2 text-start">
          <ion-text class="text-sm ml-5 text-primary-foreground">Sitio web</ion-text>
          <div class="field">
            <ion-input mode="ios" placeholder="Agregar URL" [(ngModel)]="newWebsite"
              (keyup.enter)="addWebsite()"></ion-input>
          </div>
          <ng-container *ngFor="let item of websitesList; let i = index">

            <div class="flex gap-1 justify-between items-center mt-2 px-2">
              <ion-text class="flex-1 text-primary-foreground line-clamp-1 text-ellipsis truncate">
                {{ item }}
              </ion-text>
              <ion-icon name="trash-sharp" color="grayColor" class="text-lg" (click)="removeWebsite(i)"></ion-icon>
            </div>
          </ng-container>
        </div>

      </div>
      <div class="w-full flex gap-2 justify-end items-center mt-5">
        <ion-chip [disabled]="isSubmitting"
          class="text-primary-foreground  text-md flex justify-center items-center font-medium bg-transparent px-4">
          <ion-text (click)="editProfileModal.dismiss()">
            Cancelar
          </ion-text>
        </ion-chip>
        <ion-chip [disabled]="isSubmitting"
          class="text-primary-foreground bg-primary text-md font-medium h-12 rounded-3xl py-4 px-6 flex justify-center items-center"
          (click)="updateUser(editProfileModal)">
          <ion-text>
            {{isSubmitting ? 'Guardando...': 'Guardar'}}
          </ion-text>
        </ion-chip>
      </div>
    </div>
  </ng-template>
</ion-modal>